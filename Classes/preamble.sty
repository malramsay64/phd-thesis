% This package imports my standard packages and defines
% macros that I use.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{preamble}

% Packages required for thesis
\RequirePackage[australian]{babel}
\RequirePackage{opensans}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{graphicx}
\RequirePackage{grffile}
\RequirePackage{subfig}
\RequirePackage{siunitx}
\RequirePackage{hyperref}
\RequirePackage[version=3]{mhchem}
\RequirePackage{ccicons}
\RequirePackage{xspace}
\RequirePackage{parskip}
\RequirePackage{doi}
\RequirePackage[version=3]{mhchem}
\RequirePackage{mysyntax}
\RequirePackage[export]{adjustbox}
\RequirePackage{calc}
\RequirePackage{fp}
\RequirePackage{placeins}
\RequirePackage[%
    backend=biber,
    style=nature,
    autocite=superscript,
    url=true,
    doi=false,
    isbn=false,
    eprint=false]{biblatex}

\RequirePackage{fontspec}
\defaultfontfeatures{Mapping=tex-text}
% and/or - see comments
\defaultfontfeatures{Ligatures=TeX}

% Required for markdown templated files
\RequirePackage{lmodern}
\RequirePackage{longtable}
\RequirePackage{booktabs}

% Ensure aspect ratio is kept when converting from markdown
\makeatletter
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Add date (or version) on right of page
\RequirePackage{fancyhdr}
\makeatletter
\fancypagestyle{headings}{%
  \fancyhead[LE,RO]{\textsl{\rightmark}}
  \fancyhead[LO,RE]{\textsl{\leftmark}}
  \fancyfoot[C]{\thepage}
  \fancyfoot[LE,RO]{\@date}%
}
\makeatother

\setcounter{tocdepth}{3}

% Defining an empty command to support lists in pandoc
\newcommand*{\tightlist}{}

% Defining Mathematical Terms
\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}

% Shortcuts for partial differential equations
\renewcommand*{\d}[1]{\ensuremath{d #1}}
\newcommand*{\pd}[1]{\ensuremath{\partial #1}}
\newcommand*{\dd}[1]{\ensuremath{d^2 #1}}
\newcommand*{\pdd}[1]{\ensuremath{\partial^2 #1}}

\newcommand*{\ddiff}[2]{\ensuremath{\frac{\d #1}{\d #2}}}
\newcommand*{\pddiff}[2]{\ensuremath{\frac{\pd #1}{\pd #2}}}
\newcommand*{\dddiff}[2]{\ensuremath{\frac{\dd #1}{\d #2^2}}}
\newcommand*{\pdddiff}[2]{\ensuremath{\frac{\pdd #1}{\pd #2^2}}}

 % Defining Poise as a unit
\sisetup{qualifier-mode = subscript}
\DeclareSIUnit[number-unit-product = \,]{\poise}{P}

% Shortcuts for units
\DeclareSIQualifier{\melting}{m}
\DeclareSIQualifier{\glass}{g}
\DeclareSIQualifier{\kauzmann}{k}
\DeclareSIUnit[number-unit-product = \,]{\T}{T}
\DeclareSIUnit[number-unit-product = \,]{\Tg}{\T\glass}
\DeclareSIUnit[number-unit-product = \,]{\Tm}{\T\melting}
\DeclareSIUnit[number-unit-product = \,]{\Tk}{\T\kauzmann}

\newcommand*{\e}{\ensuremath{\text{e}}\xspace}
\newcommand*{\boltzman}{\ensuremath{k_\text{B}}}

\PassOptionsToPackage{colorlinks=true, linkcolor=blue, citecolor=blue}{hyperref}

% Citations
\let\cite\supercite
\newcommand*{\linecite}[1]{Ref.~\onlinecite{#1}}

% Figures appear in section referencing them
\let\Oldsection\section
\renewcommand{\section}{\FloatBarrier\Oldsection}

% Bibliography Settings
\DeclareFieldFormat{url}{\url{#1}}
\AtEveryBibitem{\clearlist{language}} % clears language
\AtEveryBibitem{\clearlist{series}\clearfield{month}\clearfield{note}\clearfield{issue}} % clear series

\DeclareCiteCommand{\onlinecite}%[\mkbibbrackets]
    {\usebibmacro{cite:init}%
    \usebibmacro{prenote}}
    {\usebibmacro{citeindex}%
    \usebibmacro{cite:comp}}
    {}
    {\usebibmacro{cite:dump}%
    \usebibmacro{postnote}}

\renewcommand*{\textcite}[1]{%
    \citeauthor{#1}~\autocite{#1}
}

% Changing style of footnote
\renewcommand{\thefootnote}{\fnsymbol{footnote}}
